<!DOCTYPE html>
<html>
<head>
<title>Energy Spread Trading Simulator</title>

<style>
body {
    font-family: Arial;
    background: #111;
    color: white;
    text-align: center;
    margin: 0;
    padding: 0;
}

header {
    padding: 20px;
    background: #222;
    font-size: 28px;
}

button {
    padding: 12px 22px;
    margin-top: 20px;
    border: none;
    background: #29a329;
    color: white;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
}

button:hover {
    background: #1f7a1f;
}

#results {
    margin-top: 25px;
    font-size: 18px;
}

canvas {
    margin-top: 20px;
    background: #222;
    border-radius: 10px;
}
</style>

</head>

<body>

<header>
Energy Market Spread Trading Simulator
</header>

<p>
Crude Oil vs Natural Gas â€” Intraday Mean Reversion Strategy
</p>

<button onclick="runSimulation()">Run Trading Simulator</button>

<div id="results"></div>

<canvas id="chart" width="900" height="400"></canvas>

<script>
function runSimulation() {

    let minutes = 300;
    let crude = [];
    let natgas = [];

    let crudePrice = 80;
    let gasPrice = 3;

    for (let i = 0; i < minutes; i++) {
        crudePrice += (Math.random() - 0.5) * 0.6;
        gasPrice = crudePrice * 0.12 + 2.5 + (Math.random() - 0.5) * 0.2;

        crude.push(crudePrice);
        natgas.push(gasPrice);
    }

    // Build spread
    let spread = [];
    for (let i = 0; i < minutes; i++) {
        spread.push(crude[i] - 8 * natgas[i]);
    }

    function mean(arr) {
        return arr.reduce((a,b)=>a+b) / arr.length;
    }

    function stdev(arr) {
        let m = mean(arr);
        return Math.sqrt(arr.map(x => (x-m)**2).reduce((a,b)=>a+b) / arr.length);
    }

    let zscores = [];
    let lookback = 40;

    for (let i = lookback; i < spread.length; i++) {
        let slice = spread.slice(i - lookback, i);
        let m = mean(slice);
        let s = stdev(slice);
        zscores.push((spread[i] - m) / s);
    }

    let position = 0;
    let entry = 0;
    let pnl = [];
    let equity = [];
    let total = 0;

    for (let i = 0; i < zscores.length; i++) {
        let z = zscores[i];
        let s = spread[i + lookback];

        if (position === 0 && z > 2) {
            position = -1;
            entry = s;
        } else if (position === 0 && z < -2) {
            position = 1;
            entry = s;
        } 
        else if (position !== 0 && Math.abs(z) < 0.3) {
            let trade = (s - entry) * position * -1;
            total += trade;
            pnl.push(trade);
            position = 0;
        }

        equity.push(total);
    }

    let wins = pnl.filter(x => x > 0).length;

    document.getElementById("results").innerHTML =
        "<br>Total Profit: $" + total.toFixed(2) +
        "<br>Trades: " + pnl.length +
        "<br>Winning Trades: " + wins;

    drawChart(equity);
}

function drawChart(data) {
    let canvas = document.getElementById("chart");
    let ctx = canvas.getContext("2d");

    ctx.clearRect(0,0, canvas.width, canvas.height);

    ctx.strokeStyle = "lime";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, 200 - data[0]);

    for (let i = 1; i < data.length; i++) {
        ctx.lineTo(i*3, 200 - data[i]);
    }

    ctx.stroke();
}
</script>

</body>
</html>
